{
  "observation_id":"GRB130427",
  "input_images_format":"fit",
  "input_tech_frames_format":"fit",
  "sex_config_file_name":"default.sex",
  "scamp_config_file_name":"default.scamp",
  "swarp_config_file_name":"default.swarp",
  "psfex_config_file_name":"default.psfex",
  "scamp_required_catalog_params":[
	  "NUMBER",
	  "EXT_NUMBER",
	  "XWIN_IMAGE",
	  "YWIN_IMAGE",
	  "AWIN_IMAGE",
	  "BWIN_IMAGE",
	  "ERRAWIN_IMAGE",
	  "ERRBWIN_IMAGE",
	  "ERRTHETAWIN_IMAGE",
	  "ERRA_WORLD",
	  "ERRB_WORLD",
	  "ERRTHETA_WORLD",
	  "XWIN_WORLD",
	  "YWIN_WORLD",
	  "FLUX_AUTO",
	  "FLUX_MAX",
	  "FLUX_RADIUS",
	  "FLUXERR_AUTO",
	  "MAG_AUTO",
	  "MAGERR_AUTO",
	  "FLAGS",
	  "ELONGATION"
 ],
  "psfex_required_catalog_params":[
  	  "VIGNET(20,20)",
  	  "XWIN_IMAGE",
	  "YWIN_IMAGE",
	  "FLUX_RADIUS",
	  "FLUX_APER(1)",
	  "FLUXERR_APER(1)",
	  "FLAGS",
	  "ELONGATION",
	  "SNR_WIN"
  ],
  "pipeline_stages":{
	"preparation":{
		"previous_stage":"none",
		"next_stage":"images_calibration",
		"stage_params":{
			"input_params":{
				"output_from_stages":[]
			},
			"output_params":{
				"input_for_stages":["images_calibration"]
			},
			"stage_mapred_type":"none"
		},
		"stage_steps":{}
	},
	"images_calibration":{
		"previous_stage":"preparation",
		"next_stage":"images_coaddition",
		"stage_params":{
			"input_params":{
				"images_format":"fit",
				"output_from_stages":["preparation"]
			},
			"output_params":{
				"images_format":"fits",
				"input_for_stages":["images_coaddition"]
			},
			"stage_mapred_type":"map"
		},
		"stage_steps":{
			"basic_reduction":{
				"previous_step":"none",
				"next_step":"create_calibration_catalogs",
				"step_params":{
					"basic_function":"none",
					"input_params":{
						"output_from_steps":[]
					},
					"output_params":{
						"input_for_steps":["create_calibration_catalogs"]
					},
					"software_params":{
						"code":"IRAF",
						"config_file":"login.cl",
				 		"temp_path":"temp",
				 		"config":{}
					},
					"data_handle":{}
				}
			},
			"create_calibration_catalogs":{
				"previous_step":"basic_reduction",
				"next_step":"create_calibration_headers",
				"step_params":{
					"basic_function":"create_catalogs",
					"input_params":{
						"images_format":"fit",
						"images_dir":"temp",
						"output_from_steps":["basic_reduction"]
					},
					"output_params":{
						"catalogs_format":"cat",
						"catalogs_dir":"temp",
						"input_for_steps":["create_calibration_headers"],
						"check_params_for_scamp_required":"true"
					},
					"software_params":{
						"code":"SExtractor",
						"config_file":"default.sex",
				 		"temp_path":"temp",
				 		"config":{
							"FILTER":"Y",
							"FILTER_NAME":"gauss_4.0_7x7.conv",
							"ANALYSIS_THRESH":"5",
							"DETECT_THRESH":"5",
							"CATALOG_TYPE":"FITS_LDAC"
					    },
					    "params":[
							"NUMBER",
							"EXT_NUMBER",
							"XWIN_IMAGE",
							"YWIN_IMAGE",
							"AWIN_IMAGE",
							"BWIN_IMAGE",
							"ERRAWIN_IMAGE",
							"ERRBWIN_IMAGE",
							"ERRTHETAWIN_IMAGE",
							"FLUX_AUTO",
							"FLUX_MAX",
							"MAG_AUTO",
							"FLUXERR_AUTO",
							"FLAGS",
							"FLUX_RADIUS",
							"ELONGATION"
				    	]
					},
					"data_handle":{
						"params_from_fits_header":{
							"GAIN":"GAIN"
						}
					}
				}
			},
			"create_calibration_headers":{
				"previous_step":"create_calibration_catalogs",
				"next_step":"calibrate_images",
				"step_params":{
					"basic_function":"calculate_calibration",
					"input_params":{
						"catalogs_format":"cat",
						"catalogs_dir":"temp",
						"output_from_steps":["create_calibration_catalogs"]
					},
					"output_params":{
						"input_for_steps":["calibrate_images"],
						"calculate_calibration_separately":"true"
					},
					"software_params":{
						"code":"SCAMP",
						"config_file":"default.scamp",
				 		"temp_path":"temp",
				 		"config":{
							"ASTREF_BAND":"DEFAULT",
							"COMPUTE_PARALLAXES":"N",
							"MOSAIC_TYPE":"UNCHANGED",
							"SN_THRESHOLDS":"10.0,100.0",
							"CHECKPLOT_DEV":"NULL",
							"SOLVE_ASTROM":"Y",
							"ASTREF_CATALOG":"UCAC-3",
							"EXPOTIME_KEY":"EXPTIME",
							"PIXSCALE_MAXERR":"1.2",
							"FWHM_THRESHOLDS":"0.0,10.0",
							"STABILITY_TYPE":"INSTRUMENT",
							"SOLVE_PHOTOM":"Y",
							"CROSSID_RADIUS":"3.0"
					    }
					},
					"data_handle":{}
				}
			},
			"calibrate_images":{
				"previous_step":"create_calibration_headers",
				"next_step":"create_calibrated_images_catalogs",
				"step_params":{
					"basic_function":"swarp_images",
					"input_params":{
						"images_format":"fit",
						"images_dir":"temp",
						"output_from_steps":["basic_reduction,create_calibration_headers"]
					},
					"output_params":{
						"swarp_separately":"true",
						"images_format":"fits",
						"weightmaps_format":"weight.fits",
						"images_dir":"images",
						"weightmaps_dir":"images",
						"input_for_steps":["create_calibrated_images_catalogs,create_calibrated_images_catalogs_psf"]
					},
					"software_params":{
						"code":"SWarp",
						"config_file":"default.swarp",
				 		"temp_path":"temp",
				 		"config":{
							"CELESTIAL_TYPE":"NATIVE",
							"RESAMPLE_SUFFIX":".resamp.fits",
							"RESAMPLE":"N",
							"PROJECTION_TYPE":"NONE",
							"COMBINE":"Y",
							"RESAMPLE_DIR":"images",
							"DELETE_TMPFILES":"N"
					    }
					},
					"data_handle":{}
				}
			},
			"create_calibrated_images_catalogs":{
				"previous_step":"calibrate_images",
				"next_step":"model_psf_calibrated_images_catalogs",
				"step_params":{
					"basic_function":"create_catalogs",
					"input_params":{
						"images_format":"fits",
						"images_dir":"images",
						"output_from_steps":["calibrate_images"]
					},
					"output_params":{
						"catalogs_format":"cat",
						"catalogs_dir":"catalogs",
						"input_for_steps":["model_psf_calibrated_images_catalogs"],
						"check_params_for_psfex_required":"true"
					},
					"software_params":{
						"code":"SExtractor",
						"config_file":"default.sex",
				 		"temp_path":"temp",
				 		"config":{
							"FILTER":"Y",
				   			"FILTER_NAME":"gauss_4.0_7x7.conv",
				   			"ANALYSIS_THRESH":"3",
				   			"DETECT_THRESH":"3",
				   			"CATALOG_TYPE":"FITS_LDAC"
					    },
					    "params":[
							"NUMBER",
							"EXT_NUMBER",
							"XWIN_IMAGE",
							"YWIN_IMAGE",
							"AWIN_IMAGE",
							"BWIN_IMAGE",
							"ERRAWIN_IMAGE",
							"ERRBWIN_IMAGE",
							"ERRTHETAWIN_IMAGE",
							"ERRA_WORLD",
							"ERRB_WORLD",
							"ERRTHETA_WORLD",
							"XWIN_WORLD",
							"YWIN_WORLD",
							"FLUX_AUTO",
							"FLUX_MAX",
							"MAG_AUTO",
							"FLUXERR_AUTO",
							"FLAGS",
							"FLUX_RADIUS",
							"ELONGATION"
				    	]
					},
					"data_handle":{
						"params_from_fits_header":{
							"GAIN":"GAIN"
						}
					}
				}
			},
			"model_psf_calibrated_images_catalogs":{
				"previous_step":"create_calibrated_images_catalogs",
				"next_step":"create_calibrated_images_catalogs_psf",
				"step_params":{
					"basic_function":"calculate_psf",
					"input_params":{
						"catalogs_format":"cat",
						"catalogs_dir":"catalogs",
						"output_from_steps":["create_calibrated_images_catalogs"]
					},
					"output_params":{
						"psf_models_format":"psf",
						"psf_models_dir":"temp",
						"input_for_steps":["create_calibrated_images_catalogs_psf"],
						"calculate_psf_separately":"true"
					},
					"software_params":{
						"code":"PSFEx",
						"config_file":"default.psfex",
				 		"temp_path":"temp",
				 		"config":{
							"CENTER_KEYS":"XWIN_IMAGE,YWIN_IMAGE",
							"PSFVAR_KEYS":"XWIN_IMAGE,YWIN_IMAGE",
							"PHOTFLUX_KEY":"FLUX_AUTO",
							"PHOTFLUXERR_KEY":"FLUXERR_AUTO",
							"CHECKPLOT_DEV":"NULL",
							"CHECKPLOT_TYPE":"NONE",
							"CHECKIMAGE_TYPE":"NONE",
							"STABILITY_TYPE":"EXPOSURE",
							"SAMPLE_AUTOSELECT":"N",
							"SAMPLE_FWHMRANGE":"0.0,100.0",
							"SAMPLE_VARIABILITY":"0.9",
							"SAMPLE_MINSN":"20"
						}
					},
					"data_handle":{}
				}
			},
			"create_calibrated_images_catalogs_psf":{
				"previous_step":"model_psf_calibrated_images_catalogs",
				"next_step":"none",
				"step_params":{
					"basic_function":"create_catalogs",
					"input_params":{
						"images_format":"fits",
						"images_dir":"images",
						"psf_models_format":"psf",
						"psf_models_dir":"temp",
						"output_from_steps":["calibrate_images,model_psf_calibrated_images_catalogs"]
					},
					"output_params":{
						"catalogs_format":"psf.cat",
						"catalogs_dir":"catalogs",
						"input_for_steps":[],
						"check_params_for_psfex_required":"true"
					},
					"software_params":{
						"code":"SExtractor",
						"config_file":"default.sex",
				 		"temp_path":"temp",
				 		"config":{
				 			"FILTER":"Y",
				   			"FILTER_NAME":"gauss_4.0_7x7.conv",
				   			"ANALYSIS_THRESH":"3",
				   			"DETECT_THRESH":"3",
				   			"CATALOG_TYPE":"FITS_LDAC"
				 		},
					    "params":[
							"NUMBER",
							"EXT_NUMBER",
							"XWIN_IMAGE",
							"YWIN_IMAGE",
							"ERRAWIN_IMAGE",
							"ERRBWIN_IMAGE",
							"ERRTHETAWIN_IMAGE",
							"XWIN_WORLD",
							"YWIN_WORLD",
							"FLUX_AUTO",
							"FLUXERR_AUTO",
							"FLAGS",
							"FLAGS_WEIGHT",
							"FLUX_RADIUS",
							"ELONGATION",
							"MAG_AUTO",
							"MAGERR_AUTO",
							"ALPHAPSF_SKY",
							"DELTAPSF_SKY",
							"ERRX2PSF_WORLD",
							"ERRY2PSF_WORLD",
							"FLUX_PSF",
							"FLUXERR_PSF",
							"MAG_PSF",
							"MAGERR_PSF"
						]
					},
					"data_handle":{
						"params_from_fits_header":{
							"GAIN":"GAIN"
						}
					}
				}
			}
		}
	},
	"images_coaddition":{
		"previous_stage":"images_calibration",
		"next_stage":"none",
		"stage_params":{
			"input_params":{
				"images_format":"fits",
				"output_from_stages":["images_calibration"]
			},
			"output_params":{
				"input_for_stages":[]
			},
			"stage_mapred_type":"reduce"
		},
		"stage_steps":{
			"coadd_calibrated_images":{
				"previous_step":"none",
				"next_step":"create_coadded_image_catalog",
				"step_params":{
					"basic_function":"swarp_images",
					"input_params":{
						"images_format":"fits",
						"images_dir":"images",
						"output_from_steps":[]
					},
					"output_params":{
						"images_format":"coadded.fits",
						"weightmaps_format":"weight.fits",
						"images_dir":"stacks",
						"weightmaps_dir":"stacks",
						"input_for_steps":["create_coadded_image_catalog,create_coadded_image_catalog_psf"]
					},
					"software_params":{
						"code":"SWarp",
						"config_file":"default.swarp",
				 		"temp_path":"temp",
				 		"config":{
							"CELESTIAL_TYPE":"NATIVE",
						    "RESAMPLE_SUFFIX":".resamp.fits",
						    "RESAMPLE":"N",
						    "PROJECTION_TYPE":"NONE",
						    "COMBINE":"Y",
						    "COMBINE_TYPE":"MEDIAN",
						    "RESAMPLE_DIR":"temp",
						    "DELETE_TMPFILES":"Y"
					    }
					},
					"data_handle":{}
				}
			},
			"create_coadded_image_catalog":{
				"previous_step":"coadd_calibrated_images",
				"next_step":"model_psf_coadded_image_catalog",
				"step_params":{
					"basic_function":"create_catalogs",
					"input_params":{
						"images_format":"coadded.fits",
						"images_dir":"stacks",
						"output_from_steps":["coadd_calibrated_images"]
					},
					"output_params":{
						"catalogs_format":"coadded.cat",
						"catalogs_dir":"catalogs",
						"input_for_steps":["model_psf_coadded_image_catalog"],
						"check_params_for_psfex_required":"true"
					},
					"software_params":{
						"code":"SExtractor",
						"config_file":"default.sex",
				 		"temp_path":"temp",
				 		"config":{
							"FILTER":"N",
						    "FILTER_NAME":"gauss_4.0_7x7.conv",
						    "ANALYSIS_THRESH":"3",
						    "DETECT_THRESH":"3",
						    "CATALOG_TYPE":"FITS_LDAC"
					    },
					    "params":[
							"NUMBER",
						    "EXT_NUMBER",
						    "XWIN_IMAGE",
						    "YWIN_IMAGE",
						    "AWIN_IMAGE",
						    "BWIN_IMAGE",
						    "ERRAWIN_IMAGE",
						    "ERRBWIN_IMAGE",
						    "ERRTHETAWIN_IMAGE",
						    "ERRA_WORLD",
						    "ERRB_WORLD",
						    "ERRTHETA_WORLD",
						    "XWIN_WORLD",
						    "YWIN_WORLD",
						    "FLUX_AUTO",
						    "FLUX_MAX",
						    "MAG_AUTO",
						    "FLUXERR_AUTO",
						    "FLAGS",
						    "FLUX_RADIUS",
						    "ELONGATION"
			    	 	]
					},
					"data_handle":{
						"params_from_fits_header":{
							"GAIN":"GAIN"
						}
					}
				}
			},
			"model_psf_coadded_image_catalog":{
				 "previous_step":"create_coadded_image_catalog",
				 "next_step":"create_coadded_image_catalog_psf",
				 "step_params":{
					"basic_function":"calculate_psf",
					"input_params":{
						"catalogs_format":"coadded.cat",
						"catalogs_dir":"catalogs",
						"output_from_steps":["create_coadded_image_catalog"]
					},
					"output_params":{
						"psf_models_format":"coadded.psf",
						"psf_models_dir":"temp",
						"input_for_steps":["create_coadded_image_catalog_psf"]
					},
					"software_params":{
						"code":"PSFEx",
						"config_file":"default.psfex",
				 		"temp_path":"temp",
				 		"config":{
							"CENTER_KEYS":"XWIN_IMAGE,YWIN_IMAGE",
							"PSFVAR_KEYS":"XWIN_IMAGE,YWIN_IMAGE",
							"PHOTFLUX_KEY":"FLUX_AUTO",
							"PHOTFLUXERR_KEY":"FLUXERR_AUTO",
							"CHECKPLOT_DEV":"NULL",
							"CHECKPLOT_TYPE":"NONE",
							"CHECKIMAGE_TYPE":"NONE",
							"STABILITY_TYPE":"EXPOSURE",
							"SAMPLE_AUTOSELECT":"N",
							"SAMPLE_FWHMRANGE":"0.0,100.0",
							"SAMPLE_VARIABILITY":"0.9",
							"SAMPLE_MINSN":"20"
						}
					},
					"data_handle":{}
				}
			},
			"create_coadded_image_catalog_psf":{
				 "previous_step":"model_psf_coadded_image_catalog",
				 "next_step":"none",
				 "step_params":{
					"basic_function":"create_catalogs",
					"input_params":{
						"images_format":"coadded.fits",
						"images_dir":"stacks",
						"psf_models_format":"coadded.psf",
						"psf_models_dir":"temp",
						"output_from_steps":["model_psf_coadded_image_catalog,coadd_calibrated_images"]
					},
					"output_params":{
						"catalogs_format":"psf.coadded.cat",
						"catalogs_dir":"catalogs",
						"input_for_steps":[],
						"check_params_for_psfex_required":"true"
					},
					"software_params":{
						"code":"SExtractor",
						"config_file":"default.sex",
				 		"temp_path":"temp",
				 		"config":{
				 			"FILTER":"N",
						    "FILTER_NAME":"gauss_4.0_7x7.conv",
						    "ANALYSIS_THRESH":"3",
						    "DETECT_THRESH":"3",
						    "CATALOG_TYPE":"FITS_LDAC"
				 		},
					    "params":[
					    	"NUMBER",
							"EXT_NUMBER",
							"XWIN_IMAGE",
							"YWIN_IMAGE",
							"ERRAWIN_IMAGE",
							"ERRBWIN_IMAGE",
							"ERRTHETAWIN_IMAGE",
							"XWIN_WORLD",
							"YWIN_WORLD",
							"FLUX_AUTO",
							"FLUXERR_AUTO",
							"FLAGS",
							"FLAGS_WEIGHT",
							"FLUX_RADIUS",
							"ELONGATION",
							"MAG_AUTO",
							"MAGERR_AUTO",
							"ALPHAPSF_SKY",
							"DELTAPSF_SKY",
							"ERRX2PSF_WORLD",
							"ERRY2PSF_WORLD",
							"FLUX_PSF",
							"FLUXERR_PSF",
							"MAG_PSF",
							"MAGERR_PSF"
					    ]
					},
					"data_handle":{
						"params_from_fits_header":{
							"GAIN":"GAIN"
						}
					}
				}
			}
		}
	}
  }
}
